<?php

/**
* @file
* Includes the iFrameResizer.js JavaScript library for fluid width and height iframes.
*/

/**
* Implements hook_help().
*/
function iframe_resizer_help($path, $arg) {
  switch ($path) {
    case "admin/help#iframe_resizer":
      $output = '';
      $output .= '<h3>' . t('About') . '</h3>';
      $output .= '<p>' . t('iFrame Resizer is a JavaScript library which enables fluid width and height iframe embeds.') . '</p>';
      $output .= '<p>' . t('The library enables the automatic resizing of the height and width of both same and cross domain iFrames to fit their contained content. It provides a range of features to address the most common issues with using iFrames. For full documentation on the library see the project\'s <a href="@github_page">github page</a>.', array('@github_page' => url('https://github.com/davidjbradshaw/iframe-resizer'))) . '</p>';
      $output .= '<h3>' . t('Setup') . '</h3>';
      $output .= '<p>' . t('To use the module, you must first download the JavaScript library from the project\'s <a href="@github_page">github page</a>. Unpack and rename the resulting directory "iframe_resizer" and place it in your Drupal installation\'s "sites/all/libraries" directory. Make sure the path to the library\'s main file becomes: "sites/all/libraries/iframe_resizer/js/iframeResizer.min.js".', array('@github_page' => url('https://github.com/davidjbradshaw/iframe-resizer'))) . '</p>';
      $output .= '<p>' . t('Once the library is in place, you can configure the module (see the link below).') . '</p>';
      return $output;
    break;
  }
}

/**
 * Implements hook_permission().
 */
function iframe_resizer_permission() {
  return array(
    'administer iframe resizer' => array(
      'title' => t('Administer the iFrame Resizer module'),
    )
  );
}

/**
 * Implements hook_menu().
 */
function iframe_resizer_menu() {
  $items = array();

  $items['admin/config/user-interface/iframe_resizer'] = array(
    'title' => 'iFrame Resizer',
    'description' => 'Configuration for the iFrame Resizer module',
    'file' => 'iframe_resizer.admin.inc',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('iframe_resizer_admin_form'),
    'access arguments' => array('administer iframe resizer'),
  );

  return $items;
}

/**
 * Implements hook_init().
 */
function iframe_resizer_init() {
  // If the site is hosting resizable iFrames, include the necessary JS.
  if (variable_get('iframe_resizer_host', FALSE)) {
    drupal_add_js('sites/all/libraries/iframe_resizer/js/iframeResizer.js', array(
      'scope' => 'footer',
      'group' => JS_LIBRARY,
      'every_page' => TRUE,
      'requires_jquery' => FALSE,
    ));

    // iFrame Resizer library options
    $js_settings = array(
      'log' => variable_get('iframe_resizer_log', FALSE),
      'heightCalculationMethod' => variable_get('iframe_resizer_height_calculation_method', 'bodyOffset'),
    );
    drupal_add_js(array('iframe_resizer' => $js_settings), array(
      'type' => 'setting',
      'scope' => 'footer',
      'group' => JS_DEFAULT,
      'every_page' => TRUE,
    ));
    drupal_add_js(drupal_get_path('module', 'iframe_resizer') . '/js/iframe_resizer.js', array(
      'scope' => 'footer',
      'group' => JS_DEFAULT,
      'every_page' => TRUE,
    ));
  }

  // If pages from this site will be hosted within pages made resizable by the
  // iFrame Resizable library, include the necessary JS.
  if (variable_get('iframe_resizer_hosted', FALSE)) {
    drupal_add_js('sites/all/libraries/iframe_resizer/js/iframeResizer.contentWindow.js', array(
      'scope' => 'footer',
      'group' => JS_LIBRARY,
      'every_page' => TRUE,
      'requires_jquery' => FALSE,
    ));
  }
}
